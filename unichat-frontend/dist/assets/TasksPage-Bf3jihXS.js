import{R as b,l as A,r as d,j as t,P as c,u as R}from"./index-B1mjx8Bh.js";import{u as F,d as _,a as q,c as D,g as E,C as I}from"./CreateTaskForm-SDD3SKx2.js";import{a as O,c as P}from"./faculty-CxZZHNOG.js";const S=e=>{let s;const a=new Set,n=(i,p)=>{const m=typeof i=="function"?i(s):i;if(!Object.is(m,s)){const f=s;s=p??(typeof m!="object"||m===null)?m:Object.assign({},s,m),a.forEach(j=>j(s,f))}},o=()=>s,r={setState:n,getState:o,getInitialState:()=>h,subscribe:i=>(a.add(i),()=>a.delete(i))},h=s=e(n,o,r);return r},U=e=>e?S(e):S,L=e=>e;function M(e,s=L){const a=b.useSyncExternalStore(e.subscribe,()=>s(e.getState()),()=>s(e.getInitialState()));return b.useDebugValue(a),a}const k=e=>{const s=U(e),a=n=>M(s,n);return Object.assign(a,s),a},B=e=>e?k(e):k;let y;const V=()=>{if(!y){const e=localStorage.getItem("token");e&&(y=A("http://localhost:5000",{auth:{token:e}}),y.on("tasks_updated",()=>{T.getState().fetchTasks()}))}return y};V();const T=B(e=>({tasks:[],loading:!1,error:null,fetchTasks:async()=>{e({loading:!0,error:null});try{const s=await E();e({tasks:s.data,loading:!1})}catch{e({error:"Failed to fetch tasks.",loading:!1})}},addTask:async s=>{try{await D(s)}catch{e({error:"Failed to create task."})}},toggleTaskComplete:async s=>{try{await q(s._id,{isCompleted:!s.isCompleted})}catch{e({error:"Failed to update task."})}},removeTask:async s=>{try{await _(s)}catch{e({error:"Failed to delete task."})}},uploadTaskAttachment:async(s,a)=>{const n=new FormData;n.append("attachment",a);try{await F(s,n)}catch{e({error:"Failed to upload file."})}}})),N=({onAssignmentCreated:e})=>{const[s,a]=d.useState(""),[n,o]=d.useState(""),[g,u]=d.useState([]),[r,h]=d.useState([]),[i,p]=d.useState(""),[m,f]=d.useState("");d.useEffect(()=>{(async()=>{try{const x=await O();u(x.data)}catch{p("Could not load students list.")}})()},[]);const j=l=>{h(x=>x.includes(l)?x.filter(w=>w!==l):[...x,l])},v=async l=>{if(l.preventDefault(),p(""),f(""),!s.trim()||r.length===0){p("Title and at least one student are required.");return}try{await P({title:s,deadline:n,assignedTo:r}),f("Assignment created successfully!"),a(""),o(""),h([]),e&&e()}catch{p("Failed to create assignment.")}};return t.jsxs("form",{onSubmit:v,className:"p-4 border rounded-md bg-gray-50 space-y-4",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Create New Assignment"}),i&&t.jsx("p",{className:"text-red-500 text-sm",children:i}),m&&t.jsx("p",{className:"text-green-600 text-sm",children:m}),t.jsx("input",{type:"text",value:s,onChange:l=>a(l.target.value),placeholder:"Assignment Title",className:"border rounded-md p-2 w-full"}),t.jsx("input",{type:"date",value:n,onChange:l=>o(l.target.value),className:"border rounded-md p-2 w-full"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium mb-2",children:"Assign to Students:"}),t.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-md p-2 space-y-1",children:g.map(l=>t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:r.includes(l._id),onChange:()=>j(l._id),className:"mr-2"}),l.name," (",l.email,")"]},l._id))})]}),t.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded-md",children:"Create Assignment"})]})};N.propTypes={onAssignmentCreated:c.func};const C=({task:e,onToggle:s,onDelete:a,onUpload:n})=>{const o=d.useRef(null),g=u=>{const r=u.target.files[0];r&&n(e._id,r)};return t.jsxs("div",{className:`p-3 rounded-md ${e.isCompleted?"bg-gray-100 text-gray-500":"bg-white border"}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:e.isCompleted,onChange:()=>s(e),className:"mr-3 h-5 w-5"}),t.jsxs("div",{children:[t.jsx("span",{className:e.isCompleted?"line-through":"",children:e.title}),e.type==="assignment"&&t.jsx("span",{className:"text-xs bg-green-100 text-green-800 rounded-full px-2 py-1 ml-2",children:"Assignment"})]})]}),t.jsxs("div",{children:[t.jsx("button",{onClick:()=>o.current.click(),className:"text-sm text-blue-500 hover:underline mr-4",children:"Upload File"}),t.jsx("input",{type:"file",ref:o,onChange:g,className:"hidden"}),t.jsx("button",{onClick:()=>a(e._id),className:"text-red-500 hover:text-red-700",children:"Delete"})]})]}),e.attachments&&e.attachments.length>0&&t.jsxs("div",{className:"mt-2 pl-8 text-sm",children:[t.jsx("p",{className:"font-semibold",children:"Attachments:"}),t.jsx("ul",{className:"list-disc list-inside",children:e.attachments.map((u,r)=>t.jsx("li",{children:u.replace("uploads\\","")},r))})]})]})};C.propTypes={task:c.shape({_id:c.string.isRequired,title:c.string.isRequired,isCompleted:c.bool.isRequired,type:c.string,attachments:c.arrayOf(c.string)}).isRequired,onToggle:c.func.isRequired,onDelete:c.func.isRequired,onUpload:c.func.isRequired};const H=()=>{const{tasks:e,loading:s,error:a,fetchTasks:n,toggleTaskComplete:o,removeTask:g,uploadTaskAttachment:u}=T(),{user:r}=R();return d.useEffect(()=>{n()},[n]),t.jsxs("div",{className:"p-4 bg-white rounded-lg shadow h-full overflow-y-auto",children:[t.jsx("h1",{className:"text-2xl font-bold mb-4",children:r.role==="faculty"?"My Tasks & Assignments":"My Tasks"}),a&&t.jsx("p",{className:"text-red-500",children:a}),t.jsx("div",{className:"mb-6",children:r.role==="faculty"?t.jsx(N,{onAssignmentCreated:n}):t.jsx(I,{onTaskCreated:n})}),t.jsx("h2",{className:"text-xl font-bold mb-4 border-t pt-4",children:"Task List"}),s&&t.jsx("p",{children:"Loading tasks..."}),!s&&t.jsx("div",{className:"space-y-3",children:e.map(h=>t.jsx(C,{task:h,onToggle:o,onDelete:g,onUpload:u},h._id))})]})};export{H as default};
