import{e as S,u as v,r as a,j as e,C as x,a as j,b as g,Q as M,c as y,I as m,B as U,P as t}from"./index-B1mjx8Bh.js";const w=(s="")=>S.get(`/materials?course=${s}`),P=s=>S.post("/materials/upload",s,{headers:{"Content-Type":"multipart/form-data"}}),D=()=>{const{user:s}=v(),[i,c]=a.useState([]),[n,u]=a.useState(!0),[o,p]=a.useState(""),d=async()=>{try{const r=await w();c(r.data)}catch{p("Failed to fetch materials.")}finally{u(!1)}};return a.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(x,{children:e.jsxs(j,{children:[e.jsx(g,{children:"Course Materials"}),e.jsx(M,{children:"Find lecture notes, syllabi, and other resources."})]})}),s.role==="faculty"&&e.jsx(b,{onUploadSuccess:d}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(g,{children:"Available Materials"})}),e.jsxs(y,{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[n&&e.jsx("p",{children:"Loading..."}),o&&e.jsx("p",{className:"text-red-500",children:o}),!n&&i.map(r=>e.jsx(N,{material:r},r._id))]})]})]})},b=({onUploadSuccess:s})=>{const[i,c]=a.useState(null),[n,u]=a.useState(""),[o,p]=a.useState(""),[d,r]=a.useState(!1),[C,f]=a.useState(""),R=async l=>{if(l.preventDefault(),f(""),!i||!n||!o){f("Please fill all fields and select a file.");return}const h=new FormData;h.append("attachment",i),h.append("title",n),h.append("course",o),r(!0);try{await P(h),s(),u(""),p(""),c(null)}catch(q){f(q?.response?.data?.message||"Upload failed. Please try again.")}finally{r(!1)}};return e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(g,{children:"Upload New Material"})}),e.jsx("form",{onSubmit:R,className:"space-y-4",children:e.jsxs(y,{children:[e.jsx(m,{placeholder:"Course Code (e.g., CS101)",value:o,onChange:l=>p(l.target.value)}),e.jsx(m,{placeholder:"Material Title (e.g., Week 1 Lecture Notes)",value:n,onChange:l=>u(l.target.value)}),e.jsx(m,{type:"file",onChange:l=>c(l.target.files[0])}),C&&e.jsx("p",{className:"text-red-500 text-sm",children:C}),e.jsx(U,{type:"submit",disabled:d,children:d?"Uploading...":"Upload"})]})})]})};b.propTypes={onUploadSuccess:t.func.isRequired};const N=({material:s})=>{const i=`${"http://localhost:5000/api".replace("/api","")}/${s.filePath}`;return e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:s.title}),e.jsxs(M,{children:["Course: ",s.course]})]}),e.jsxs(y,{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Uploaded by: ",s.uploadedBy.name]}),e.jsx(U,{asChild:!0,className:"mt-4 w-full",children:e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",children:"Download"})})]})]})};N.propTypes={material:t.shape({_id:t.string.isRequired,filePath:t.string.isRequired,title:t.string.isRequired,course:t.string.isRequired,uploadedBy:t.shape({name:t.string.isRequired}).isRequired}).isRequired};export{D as default};
